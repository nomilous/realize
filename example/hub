#! /usr/bin/env coffee

Hub = require('notice').hub 

    client: 
        capsule:
            realize: {}

Hub.create 

    title: 'Old Mother Goose'
    listen: 
        adaptor:  'socket.io'
        port:     30201
        secret:   'âˆ†'

    (err, omg) -> 

        return err.toString() if err?

        omg.use 

            title: 'EavesDropper'
            (next, capsule, traverse) -> 

                #
                # pretend to be objective
                #

                if capsule.control == 'start'

                    setTimeout (-> 

                        #
                        # call realizer to load phrase tree
                        #

                        traverse.origin.realize 'load'

                    ), 200
                    return next()


                if capsule.phrase == 'phrase::recurse:end'

                    #
                    # show the resulting phrase tokens
                    #

                    console.log capsule
                    return next()


                console.log "[#{capsule._type}] #{capsule[capsule._type]}"
                # console.log traverse.origin
                # console.log capsule
                next()
