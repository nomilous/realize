// Generated by CoffeeScript 1.6.3
var configure, deferred, error, fs, pipeline, _ref;

_ref = require('also'), deferred = _ref.deferred, pipeline = _ref.pipeline;

fs = require('fs');

error = require('./error');

module.exports = configure = deferred(function(action, params) {
  var filename, load, notify, reject, resolve, validate;
  if (params == null) {
    params = {};
  }
  resolve = action.resolve, reject = action.reject, notify = action.notify;
  filename = params.filename;
  validate = deferred(function(_arg) {
    var reject, resolve;
    resolve = _arg.resolve, reject = _arg.reject;
    if (filename != null) {
      return resolve();
    }
    return reject(error({
      errno: 10001,
      code: 'ENOREALIZER',
      message: 'No realizer specified. (-f <file>)'
    }));
  });
  load = deferred(function(_arg) {
    var reject, resolve;
    resolve = _arg.resolve, reject = _arg.reject;
    return fs.readFile(filename, 'utf8', function(err, content) {
      if (err != null) {
        return reject(err);
      }
      return resolve(content);
    });
  });
  return pipeline([
    function() {
      return validate();
    }, function() {
      return load();
    }, function(raw) {
      return console.log(raw);
    }
  ]).then(resolve, reject, notify);
});
